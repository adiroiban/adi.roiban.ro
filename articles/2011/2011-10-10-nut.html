<!doctype html>
<html lang="en">
  <head>
  <title>Adi Roiban</title>
  <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
  <meta name="description" content="Adi Roiban (aka Roiban Mircea Adrian) personal blog." />
  <link rel="stylesheet" type="text/css"
    media="screen"
    href="/media/css/reset.css" />
  <link rel="stylesheet" type="text/css"
    media="screen"
    href="/media/css/960.css" />
  <link rel="stylesheet" type="text/css"
    media="screen"
    href="/media/css/style.css" />

  <link
    rel="alternate" type="application/rss+xml"
    title="Adi Roiban RSS Feed"
    href="/atom.xml" />
  <meta name="generator" content="Hyde" />
</head>

<body>
  <!-- header starts -->
  <div id="header-wrap">
    <div id="header" class="container_16">                        
      <div>
        <h1 id="logo-text">
          <a href="/" title="">Adi Roiban</a>
        </h1>
      </div>

      <div>
        <p id="intro">Who wipes ?</p>               
      </div>
          
      <div id="nav">
          <ul>
                    <li class="page_item">
              <a href="/index.html">
                  Home
              </a>
          </li>          <li class="page_item">
              <a href="/about.html">
                  About me
              </a>
          </li>          <li class="page_item">
              <a href="/belief.html">
                  My belief
              </a>
          </li>        </ul>       
      </div>      

      <div id="header-image"></div>
      <form id="quick-search" action="http://adi.roiban.ro/" method="get" >
          <p>
          <label for="qsearch">Search:</label>
          <input class="tbox" id="qsearch" type="text" name="s" value="" title="Start typing and hit ENTER" />
          <input class="btn" alt="Search" type="image"  title="Search" src="/media/img/search.gif" />
          </p>
      </form>
    </div>
  </div>
  <!-- header ends -->


  <!-- content starts -->
  <div id="content-outer">
    <div id="content-wrapper" class="container_16">

      <!-- main -->
      <div id="main" class="grid_8">
                <h2>
          <a href="/articles/2011/2011-10-10-nut.html" rel="bookmark" title="Permanent Link to Monitor the UPS in Ubuntu with Network UPS Tools">Monitor the UPS in Ubuntu with Network UPS Tools</a>
        </h2>
        
                  <div class="document">
<p>I just found this great project called
<a class="reference external" href="http://www.networkupstools.org">Network UPS Tools or nut</a> .
It comes with fully loaded with tools for monitoring local UPS, remote
UPS and displaying the status via a weg page.</p>
<p>My installation is using an Must PowerAgent 1060, connected via USB.</p>
<p>Installing the software is easy, just use the magic words:</p>
<pre class="literal-block">
sudo apt-get install nut nut-cgi
</pre>
<p>To configure nut on Ubuntu I start by reading
<a class="reference external" href="http://blog.shadypixel.com/monitoring-a-ups-with-nut-on-debian-or-ubuntu-linux">this guide by a mysterious person named Shady Pixel</a>.</p>
<p>First I checked my driver suitable for my model in the
<a class="reference external" href="http://www.networkupstools.org/stable-hcl.html">Hardware Compatibility List</a>.
The model I use is not in the list, but Must is related to Mustek and all
Mustek models were using <tt class="docutils literal">blazer_usb</tt> driver.
So I went for blazer_usb.</p>
<p>I added the following section in /etc/nut/ups.conf
(you can replace must-pa-1060 with your preferred name for the UPS):</p>
<pre class="literal-block">
# /etc/nut/ups.conf
[must-pa-1060]
    driver = blazer_usb
    port = auto
</pre>
<p>I looked for the Bus and Device number together
with Vendor and Product in <cite>lsusb</cite>.</p>
<p>I changed the permission to <tt class="docutils literal">666</tt> for /dev/bus/usb/BID/DID
(replace BID with your USB bus ID, and DID with device ID).
To automatically set the permission for future connections I
added the following udev rule:</p>
<pre class="literal-block">
#/etc/udev/rules.d/10-must-pa-1060.rules
SYSFS{idVendor}=='0665', SYSFS{idProduct}=='5161', MODE='0666'
</pre>
<p>Then I started the UPS driver via:</p>
<pre class="literal-block">
$ sudo upsdrvctl start
</pre>
<p>If you get some errors like the one below, check the USB device permissions:</p>
<pre class="literal-block">
Can't claim USB device [0665:5161]: could not detach kernel driver from
interface 0: Operation not permitted
Driver failed to start (exit status=1)
</pre>
<p>Now that the UPS driver is started, lets monitor it and export the status via
the CGI script.</p>
<p>You will have to configure the mode in which nut will run.
Edit <tt class="docutils literal">/etc/nut/nut.conf</tt> and add your preferred mode:</p>
<pre class="literal-block">
# /etc/nut/nut.conf
MODE=standalone
</pre>
<p>Add an UPS daemon user via /etc/nut/upsd.users:</p>
<pre class="literal-block">
# /etc/nut/upsd.users
[ups_admin]
password = a password here
upsmon master
</pre>
<p>Configure the monitor to connect to this daemon via <tt class="docutils literal">/etc/nut/upsmon.conf</tt>:</p>
<pre class="literal-block">
# /etc/nut/upsmon.conf
MONITOR must-pa-1060&#64;localhost 1 ups_admin the_password_here master
</pre>
<p>Now you can start the nut daemon and ups monitor via <tt class="docutils literal">nut</tt> service:</p>
<pre class="literal-block">
sudo service nut start
</pre>
<p>To monitor the UPS via the web CGI script I added the following line to
<tt class="docutils literal">/etc/nut/hosts.conf</tt>:</p>
<pre class="literal-block">
# /etc/nut/hosts.conf
MONITOR must-pa-1060&#64;localhost 'Must PowerAgent 1060'
</pre>
<p>Now you can access the CGI script via:</p>
<pre class="literal-block">
http://HOSTNAME/cgi-bin/nut/upsstats.cgi
</pre>
<p>Enjoy!</p>
<p>This should be a good start, and from here you can take it to the next level.
For example, if you have 2 computers connected to the same UPS, the second
one will have to monitor the UPS daemon from the one connected via the usb to
the UPS make sure that the switch is allow connected to the UPS :)</p>
</div>
        
                <p class="postmeta">
            <span class="date">
              <a href="/articles/2011/2011-10-10-nut.html" rel="bookmark" title="Permanent Link to Monitor the UPS in Ubuntu with Network UPS Tools">
                Permalink
              </a>
              |
              Created Monday, 10 October 2011
              |
              Last updated Monday, 10 October 2011
            </span>
        </p>
        
              <div class="alignleft">
              <a href="/articles/2011/2011-08-03-flosscamp-se-apropie.html">« Older post</a>
            </div>

      <div class="alignright">
              <a href="/articles/2012/2012-04-10-inapoi-la-pagini-statice.html">Newer post »</a>
            </div>
        
        <script type="text/javascript">
  var disqus_identifier = '/articles/2011/2011-10-10-nut.html';
</script>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'adiroiban';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
      <!-- main ends -->


      <!-- left-columns starts -->
      <div id="left-columns" class="grid_4">
          <div class="grid_4 omega">
                    <div class="sidemenu">
  <h3>Categories</h3>
  <ul>

            <li class="cat-item cat-item-19">
      <a
        href="/tags/english.html"
        title="View all posts filed under English">
          English
      </a> (1)
    </li>
            <li class="cat-item cat-item-19">
      <a
        href="/tags/romanian.html"
        title="View all posts filed under Romanian">
          Romanian
      </a> (3)
    </li>
            <li class="cat-item cat-item-19">
      <a
        href="/tags/python.html"
        title="View all posts filed under Python">
          Python
      </a> (0)
    </li>
            <li class="cat-item cat-item-19">
      <a
        href="/tags/free-software.html"
        title="View all posts filed under Free Software">
          Free Software
      </a> (2)
    </li>
            <li class="cat-item cat-item-19">
      <a
        href="/tags/planet-gnome.html"
        title="View all posts filed under Planet GNOME">
          Planet GNOME
      </a> (0)
    </li>
            <li class="cat-item cat-item-19">
      <a
        href="/tags/planet-ubuntu.html"
        title="View all posts filed under Planet Ubuntu">
          Planet Ubuntu
      </a> (0)
    </li>
      </ul>
</div>


                    <div class="sidemenu">
  <div class="textwidget">
    <a href="http://en.wikipedia.org/wiki/Animal_liberation_movement">
        <img src="/media/img/liberation.jpg" alt="Animal Liberation Human Liberation">
      </a><a href="http://en.wikipedia.org/wiki/Waste_hierarchy">
        <img src="/media/img/reduce-reuse-recycle.jpg" alt="Reduce Reuse Recycle">
      </a><a href="http://www.couchsurfing.org/">
        <img src="/media/img/cs.png" alt="CouchSurfing">
      </a><a href="http://www.reactieinlant.ro/">
        <img src="/media/img/reactieinlant.gif" alt="Reactie in Lant">
      </a>  </div>
</div>  

          </div>

      </div>
      <!-- end left-columns -->

    </div>
  </div>
  <!-- content ends -->

  <!-- footer starts -->
  <div id="footer-wrapper" class="container_16">
    <div id="footer-bottom">

      <p class="bottom-left">
        &copy;Adi Roiban |
        Source on <a href="https://github.com/adiroiban/adiroiban.github.com">GitHub</a> |
        Generated using <a href="http://hyde.github.com/">Hyde</a> |
        Design by : <a href="http://www.styleshout.com/">styleshout</a> |
        Theme by : <a href="http://www.themelab.com">Theme Lab</a> and
          <a href="http://www.websiteoffice.com/2008/06/reputation-link-bait/">Link Bait</a>
      </p>

      <p class="bottom-right" >
        <a href="http://adi.roiban.ro">Home</a> |
        <a href="/atom.xml">
          RSS Feeds
        </a>
      </p>

    </div>  
  </div>

</body>
</html>